<?xml version='1.0' encoding='UTF-8' ?>
<!-- Created by Uniface - (C) Uniface B.V. All rights reserved -->
<!DOCTYPE UNIFACE PUBLIC "UNIFACE.DTD" "UNIFACE.DTD">
<UNIFACE release="9.6" xmlengine="2.0">
<TABLE>
<DSC name="ULIBR" model="DICT" system="S" pseudo ="73" level="1" noupdate="0"
 rbk="0" ffsql="0" transnr="0" segsize="0" ufocc="0" charset=".U">
<FLD name="ULIBRARY" seqno="1" type="S" level="2" pack="0" scale="0" length="16"
 pointer="0" inum="1" ufocc="0" mandatory="yes" idxnum="1" idxsnr="101" />
<FLD name="UDESCR" seqno="2" type="S" level="2" pack="0" scale="0" length="25"
 pointer="0" inum="0" ufocc="0" />
<FLD name="UTIMESTAMP" seqno="3" type="E" level="2" pack="0" scale="0" length="15"
 pointer="0" inum="0" ufocc="0" />
</DSC>
<OCC>
<DAT name="ULIBRARY">UFIELD</DAT>
<DAT name="UDESCR" xml:space='preserve'>Field proc</DAT>
<DAT name="UTIMESTAMP">2015-10-07T09:11:20.00</DAT>
</OCC>
</TABLE>
<TABLE>
<DSC name="USOURCE" model="DICT" system="S" pseudo ="73" level="1" noupdate="0"
 rbk="0" ffsql="0" transnr="0" segsize="0" ufocc="500" charset=".U">
<FLD name="UTIMESTAMP" seqno="1" type="E" level="2" pack="0" scale="0" length="15"
 pointer="0" inum="0" ufocc="0" />
<FLD name="UCOMPSTAMP" seqno="2" type="E" level="2" pack="0" scale="0" length="15"
 pointer="0" inum="0" ufocc="0" />
<FLD name="USTAT" seqno="3" type="S" level="2" pack="0" scale="0" length="1"
 pointer="0" inum="0" ufocc="0" />
<FLD name="USUB" seqno="4" type="S" level="2" pack="0" scale="0" length="1"
 pointer="0" inum="2" ufocc="0" mandatory="yes" idxnum="1,2" idxsnr="101,1" />
<FLD name="UVAR" seqno="5" type="S" level="2" pack="0" scale="0" length="16"
 pointer="0" inum="2" ufocc="0" mandatory="yes" idxnum="1,2" idxsnr="102,2" />
<FLD name="ULABEL" seqno="6" type="S" level="2" pack="0" scale="0" length="16"
 pointer="0" inum="1" ufocc="0" mandatory="yes" idxnum="1" idxsnr="103" />
<FLD name="ULAN" seqno="7" type="S" level="2" pack="0" scale="0" length="3"
 pointer="0" inum="1" ufocc="0" mandatory="yes" idxnum="1" idxsnr="104" />
<FLD name="MSGTYPE" seqno="8" type="S" level="2" pack="0" scale="0" length="1"
 pointer="0" inum="0" ufocc="0" />
<FLD name="UVERS" seqno="9" type="S" level="2" pack="0" scale="0" length="12"
 pointer="0" inum="0" ufocc="0" />
<FLD name="UDESCR" seqno="10" type="S" level="2" pack="0" scale="0" length="25"
 pointer="0" inum="0" ufocc="0" />
<FLD name="UVPOS" seqno="11" type="S" level="2" pack="0" scale="0" length="6"
 pointer="0" inum="0" ufocc="0" />
<FLD name="UHPOS" seqno="12" type="S" level="2" pack="0" scale="0" length="6"
 pointer="0" inum="0" ufocc="0" />
<FLD name="UVSIZ" seqno="13" type="S" level="2" pack="0" scale="0" length="6"
 pointer="0" inum="0" ufocc="0" />
<FLD name="UHSIZ" seqno="14" type="S" level="2" pack="0" scale="0" length="6"
 pointer="0" inum="0" ufocc="0" />
<FLD name="AUTHORIZ" seqno="15" type="S" level="2" pack="0" scale="0" length="1"
 pointer="0" inum="0" ufocc="0" />
<FLD name="UCLASS" seqno="16" type="S" level="2" pack="0" scale="0" length="1"
 pointer="0" inum="0" ufocc="0" />
<FLD name="LOCREF" seqno="17" type="S" level="2" pack="0" scale="0" length="1"
 pointer="0" inum="0" ufocc="0" />
<FLD name="UCONFIRM" seqno="18" type="B" level="2" pack="0" scale="0" length="1"
 pointer="0" inum="0" ufocc="0" />
<FLD name="UAUDIO" seqno="19" type="N" level="2" pack="10" scale="0" length="1"
 pointer="0" inum="0" ufocc="0" />
<FLD name="UCOMMENT" seqno="20" type="S" level="2" pack="141" scale="0" length="0"
 pointer="0" inum="0" ufocc="0" varinfo=",0,0,0,,1,0,1,\1D,0,0,0,," />
<FLD name="UTEXT" seqno="21" type="S" level="2" pack="141" scale="0" length="0"
 pointer="0" inum="0" ufocc="0" varinfo=",1,0,1,\1E,0,0,0,,0,0,0,," />
<FLD name="UWLEVEL" seqno="22" type="S" level="2" pack="141" scale="0" length="0"
 pointer="0" inum="0" ufocc="0" varinfo=",1,0,2,\1F\C1,0,0,0,,0,0,0,," />
</DSC>
<OCC>
<DAT name="UTIMESTAMP">2015-10-07T09:16:30.00</DAT>
<DAT name="USUB">I</DAT>
<DAT name="UVAR">UFIELD</DAT>
<DAT name="ULABEL">IP_MOVE_ELEMENT</DAT>
<DAT name="ULAN">P</DAT>
<DAT name="UDESCR" xml:space='preserve'>Mofe value to other fld</DAT>
<DAT name="UTEXT" xml:space='preserve'>entry IP_MOVE_ELEMENT
   ; move an element from one field to the other 
   ; @prerequisites UFIELD:IP_SET_SELECTION
   ; @prerequisites UGENERAL:IP_ERR_CALL
   params 
      string p_nmsource : in 
      string p_nmtarget : in 
   endparams 
   variables 
       string v_value, v_representation
   endvariables

   if (p_nmsource = "" | p_nmtarget = "") 
      message "IP_MOVE_ELEMENT - Source and target fields are required"
      return -1
   endif 
   if (p_nmsource = p_nmtarget)
      message "IP_MOVE_ELEMENT - Source and target fields cannot refer to the same field %%p_nmsource%%%."
      return -1
   endif 
   
   ; get the selected value and the representation 
   v_value = @p_nmsource
   v_representation = $item(v_value, $valrep(p_nmsource))

   ; this may happen when we move a value but have gotten the source and target mixed up.
   if (v_value = "" || v_representation = "") 
      message "IP_MOVE_ELEMENT - Unable to continue. No value selected or representation is empty."
      return -1
   endif 

   ; put it in the target and remove it from the source
   putitem/id $valrep(p_nmtarget), v_value, v_representation
   delitem/id $valrep(p_nmsource), v_value

   ; sort the list 
   $valrep(p_nmtarget) = $sortlist($valrep(p_nmtarget), "$valuepart: ascending")

   ; now make sure that there is an active selection 
   call IP_SET_SELECTION(p_nmsource)
   #include UGENERAL:IP_ERR_CALL

   ; set an active selection for the target field as well
   call IP_SET_SELECTION(p_nmtarget)
   #include UGENERAL:IP_ERR_CALL

   return 0
end ; IP_MOVE_ELEMENT
</DAT>
</OCC>
<OCC>
<DAT name="UTIMESTAMP">2015-10-07T09:13:44.00</DAT>
<DAT name="USUB">I</DAT>
<DAT name="UVAR">UFIELD</DAT>
<DAT name="ULABEL">IP_SET_SELECTION</DAT>
<DAT name="ULAN">P</DAT>
<DAT name="UDESCR" xml:space='preserve'>Set an active selection</DAT>
<DAT name="UTEXT" xml:space='preserve'>entry IP_SET_SELECTION
   ; set the selection of a field with a valrep
   params 
      string p_nmfield : in
   endparams 
   variables 
      string v_ftrepresentation
   endvariables 

   ; if the value is no longer in the list go to the next 
   ; if when we transported the first value to the other side we need to set it as well
   getitem/id v_ftrepresentation, $valrep(p_nmfield), @p_nmfield
   if ($valrep(p_nmfield) != "" || v_ftrepresentation = "")
      ; refill the representation 
      getitem v_ftrepresentation, $valrep(p_nmfield), 1
      @p_nmfield = $idpart(v_ftrepresentation)
   endif  

   return 0 
end ; IP_SET_SELECTION
</DAT>
</OCC>
</TABLE>
</UNIFACE>
